<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simulasi Barcode Reader</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-5 bg-light">
    <div class="container card shadow p-4" style="max-width: 500px;">
        <h2 class="mb-4">Simulasi Barcode Reader</h2>
        <div class="mb-3">
            <label for="qr_code" class="form-label fw-bold">1. Hasil Scan QR (Ketik Manual)</label>
            <input type="text" class="form-control form-control-lg" id="qr_code" placeholder="Ketik kode QR...">
        </div>
        <div class="d-grid">
            <button class="btn btn-primary btn-lg" type="button" onclick="kirimQr()">Kirim QR ke Otak Lokal</button>
        </div>
        <hr class="my-4">
        <h4 class="mb-3">Respons dari Otak Lokal (10.10.10.12):</h4>
        <pre id="response-box" class="bg-dark text-white p-3 rounded" style="min-height: 100px;">...</pre>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        function kirimQr() {
            var qr = $('#qr_code').val();
            var responseBox = $('#response-box');
            responseBox.css('color', 'yellow').text('Mengirim QR ke Otak Lokal...');

            // Panggil API "Otak Lokal" (Flask) di IP 10.10.10.12
            $.ajax({
                url: 'http://10.10.10.12:5000/api/terima_qr', // <-- IP OTAK LOKAL
                type: 'POST',
                data: { qr_code: qr },
                dataType: 'json',
                success: function(response) {
                    // Tampilkan respons (bisa dari Otak Lokal, bisa dari Laravel)
                    if(response.success === true) {
                        responseBox.css('color', 'lime');
                    } else if (response.success === false) {
                        responseBox.css('color', 'red');
                    } else {
                        responseBox.css('color', 'cyan'); // Status "menunggu"
                    }
                    responseBox.text(JSON.stringify(response, null, 2));
                },
                error: function(xhr) {
                    responseBox.css('color', 'red');
                    responseBox.text('Gagal terhubung ke Otak Lokal (10.10.10.12:5000). Pastikan skrip python berjalan dan IP sudah benar.');
                }
            });
        }
    </script>
</body>
</html>