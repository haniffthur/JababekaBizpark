<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uji Coba "Otak Lokal" Gerbang</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; }
        .simulator { max-width: 600px; margin: 50px auto; padding: 30px; background: #fff; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        #response-box { background-color: #2a2a2a; color: #00ff00; padding: 15px; border-radius: 8px; font-family: 'Courier New', Courier, monospace; min-height: 100px; white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>

    <div class="simulator">
        <h2 class="mb-4 text-center">Simulator "Otak Lokal" Gerbang</h2>
        <hr class="mb-4">
        
        <div class="mb-3">
            <label for="qr_code" class="form-label"><b>1. Data dari Barcode Reader:</b></label>
            <input type="text" class="form-control" id="qr_code" placeholder="Tempelkan Kode QR dari database...">
        </div>
        
        <div class="mb-3">
            <label for="license_plate" class="form-label"><b>2. Data dari Kamera LPR:</b></label>
            <input type="text" class="form-control" id="license_plate" placeholder="Masukkan Plat Nomor...">
        </div>
        
        <div class="d-grid gap-2 d-md-flex justify-content-md-center mt-4">
            <button class="btn btn-success btn-lg" type="button" onclick="kirimRequest('check-in')">
                KIRIM CHECK-IN
            </button>
            <button class="btn btn-danger btn-lg" type="button" onclick="kirimRequest('check-out')">
                KIRIM CHECK-OUT
            </button>
        </div>
        
        <hr class="my-4">
        
        <h4 class="mb-3">Respons dari API Laravel (Cloud):</h4>
        <div id="response-box">
            Menunggu panggilan API...
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <script>
        function kirimRequest(tipe) {
            // 1. Ambil data dari input
            var qr = $('#qr_code').val();
            var plat = $('#license_plate').val();
            
            // 2. Tentukan URL API Laravel (pastikan port 8000 sudah benar)
            var apiUrl = 'http://127.0.0.1:8000/api/gate/' + tipe;
            
            var dataRequest = {
                qr_code: qr,
                license_plate: plat
            };
            
            var responseBox = $('#response-box');
            responseBox.css('color', '#ffa500').text('Memanggil API ' + tipe + '...');
            
            // 3. Panggil API menggunakan AJAX (Method GET)
            $.ajax({
                url: apiUrl,
                type: 'GET',
                data: dataRequest,
                dataType: 'json',
                success: function(response) {
                    // SUKSES
                    responseBox.css('color', '#00ff00');
                    responseBox.text(JSON.stringify(response, null, 2));
                },
                error: function(xhr, status, error) {
                    // GAGAL
                    responseBox.css('color', '#ff4136');
                    if (xhr.responseJSON) {
                        responseBox.text(JSON.stringify(xhr.responseJSON, null, 2));
                    } else {
                        responseBox.text('Error: Gagal terhubung ke API. Pastikan "php artisan serve" berjalan.');
                    }
                }
            });
        }
    </script>

</body>
</html>